# タイピングゲーム開発ドキュメント

## ファイル構造とデータフロー

### プロジェクト構造
```
Aphorism-Typing-Game/
├── public/
│   └── usutaku_DB_UTF8.csv          # メインのCSVデータベース
├── src/
│   ├── components/
│   │   ├── CharacterPanel.jsx       # キャラクターパネルコンポーネント
│   │   ├── HUD.jsx                  # スコア・時間表示
│   │   └── TypingDisplay.jsx        # タイピング表示メイン
│   ├── data/
│   │   ├── aphorisms.js             # （旧データ）
│   │   └── usutakuData.js           # CSV変換済みデータ（APHORISMS配列）
│   ├── hooks/
│   │   ├── useAudio.js              # 音声再生フック
│   │   └── useGameLogic.js          # ゲームロジック（メイン）
│   └── utils/
│       ├── kanaToRomaji.js          # かな→ローマ字変換テーブル
│       ├── romaji.js                # ローマ字マッチングロジック
│       └── typingData.js            # タイピングデータ処理
├── convert_csv.js                   # CSV変換スクリプト
└── process_csv.js                   # CSV処理スクリプト
```

### CSVから問題出題までの流れ

1. **CSVファイル準備**
   - `public/usutaku_DB_UTF8.csv` に格言・名言データを格納
   - 各行には日本語テキストとローマ字候補が含まれる

2. **CSVデータの変換**
   - `convert_csv.js` または `process_csv.js` を実行
   - CSV → `src/data/usutakuData.js` のAPHORISMS配列に変換
   - 各項目には以下が含まれる：
     - `id`: 一意のID
     - `original`: 日本語原文
     - `text`: ローマ字テキスト
     - `tokens`: 複数のローマ字候補（`|`区切りで複数の入力方法を許容）

3. **ゲームロジックでの読み込み**（`src/hooks/useGameLogic.js`）
   - `APHORISMS`配列をインポート
   - `convertAphorismsToGameData()`で正規化処理
   - `normalizeRomajiCandidates()`で複数のローマ字候補を展開

4. **入力判定**（`src/utils/romaji.js`）
   - `matchRomajiInput()`でユーザー入力と候補を比較
   - 複数の入力パターンに対応（si/shi、cho/tyo、ha/waなど）
   - 前方一致で正誤判定を実施

5. **かな→ローマ字変換**（`src/utils/kanaToRomaji.js`）
   - `KANA_TO_ROMAJI`テーブルで複数のローマ字表記を定義
   - 訓令式とヘボン式の両方をサポート

## テストで確認すべき事項

### 複数入力パターンの動作確認

タイピングゲームでは、1つのかな文字に対して複数のローマ字入力を許容しています。
以下のパターンが正しく動作することを必ず確認してください：

#### 基本的な複数入力パターン
- **し**: `si` / `shi` / `ci`
- **ち**: `ti` / `chi`
- **つ**: `tu` / `tsu`
- **ふ**: `hu` / `fu`
- **じ**: `zi` / `ji`

#### 助詞の複数入力
- **は**（助詞）: `ha` / `wa`
- **へ**（助詞）: `he` / `e`
- **を**: `wo` / `o`

#### 拗音の複数入力
- **しゃ**: `sya` / `sha`
- **しゅ**: `syu` / `shu`
- **しょ**: `syo` / `sho`
- **ちゃ**: `tya` / `cha` / `cya`
- **ちゅ**: `tyu` / `chu` / `cyu`
- **ちょ**: `tyo` / `cho` / `cyo`
- **じゃ**: `zya` / `ja` / `jya`
- **じゅ**: `zyu` / `ju` / `jyu`
- **じょ**: `zyo` / `jo` / `jyo`

#### 特殊な「ん」の入力
- **ん**: `n` / `nn` / `xn`

### テスト手順
1. 各パターンについて、すべての入力方法を試す
2. 誤判定（正しい入力がミス扱い）されないことを確認
3. 途中で入力方法を切り替えても正しく動作することを確認
4. エッジケース（連続する「ん」など）を確認

## リポジトリのルール

### ブランチ戦略
1. **開発ブランチ**: `feature-development2`
   - すべての新機能・修正はこのブランチで開発
   - 直接 `main` にプッシュしない

2. **マージフロー**:
   ```
   作業 → feature-development2 にコミット・プッシュ
         ↓
   main ブランチへプルリクエスト作成
         ↓
   レビュー・承認後にマージ
   ```

3. **コミットメッセージ**:
   - 日本語でOK
   - 変更内容を簡潔に記述

### プルリクエストのルール
- PRタイトルは変更内容を明確に
- 大きな変更の場合は、変更理由と影響範囲を記載
- テスト済みであることを確認してからPRを作成

## ゲーム特有の実装事項

### 現在実装済み
- タイピング入力判定（複数ローマ字対応）
- スコアシステム
- タイマー機能
- ミス回数カウント
- 音声フィードバック（correct/mistake/finish）
- HUD表示（時間・スコア）

### 未実装（今後の予定）
1. **背景画像の組み込み**
   - ゲーム画面に背景画像を追加
   - テーマに合った雰囲気作り
   - 実装場所: `src/App.jsx` または `src/components/TypingDisplay.jsx`

2. **音声の拡張**
   - BGM追加
   - より多様な効果音（コンボ、特殊スキルなど）
   - 実装場所: `src/hooks/useAudio.js`

3. **その他検討中の機能**
   - キャラクターアニメーション
   - ステージシステム
   - ランキング機能

## Claudeミス管理システム

### 目的
**同じミスを繰り返さないため**、Claudeが開発中に犯したミスや注意点を即座に記録し、今後の開発で参照できるようにする。

### 運用ルール

1. **即時記録**
   - Claudeがミス（バグ、誤実装、見落としなど）をしたら、その場でこのセクションに追記する
   - ミスの内容、原因、正しい対処法を明記

2. **記録フォーマット**
   ```
   ### [日付] ミスの概要
   - **何が起きたか**: ミスの内容
   - **原因**: なぜミスが発生したか
   - **正しい対処**: 今後どうすべきか
   - **関連ファイル**: 影響を受けたファイル
   ```

3. **定期的な見直し**
   - 新しい作業を始める前に、このセクションを確認
   - 同様のミスを繰り返さないよう注意

### ミス一覧





